function sendCmd(a){$.ajax({type:"GET",url:"/command/?cmd="+a,cache:!1})}function checkWebSocket(){return window.WebSocket?"websocket":"longpolling"}function checkWorkers(){return window.Worker&&window.Blob||Modernizr.webworkers&&Modernizr.blobconstructor?!0:!1}function parsePath(a){var b=a&&a.length?a.lastIndexOf("/"):0,c="";return b&&-1!==b&&(c=a.slice(0,b)),c}function refreshTimer(a,b,c){var d=$("#countdown-display");d.countdown("destroy"),d.countdown({since:"stop"!==c||void 0!==c?-a:0,compact:!0,format:"MS"}),"play"!==c&&d.countdown("pause")}function refreshKnob(){window.clearInterval(GUI.currentKnob);var a=10*parseInt(GUI.json.song_percent),b=parseInt(GUI.json.time),c=parseInt(1e3/b),d=$("#time");d.val(a,!1).trigger("update"),"play"===GUI.state&&(GUI.currentKnob=setInterval(function(){a+="visible"!==GUI.visibility?c:1,d.val(a,!1).trigger("update")},b))}function timeConvert(a){var b=Math.floor(a/60);a-=60*b;var c=10>b?"0"+b:b,d=10>a?"0"+a:a;return c+":"+d}function timeConvert2(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60);return a=Math.floor(a-3600*b-60*c),b>0?(10>b&&(b="0"+b),b+=":"):b="",10>c&&(c="0"+c),10>a&&(a="0"+a),b+c+":"+a}function countdownRestart(a){var b=$("#countdown-display").countdown("destroy");b.countdown({since:-a,compact:!0,format:"MS"})}function setvol(a){$("#volume").val(a,!1).trigger("update"),GUI.volume=a,$("#volumemute").removeClass("btn-primary"),sendCmd("setvol "+a)}function volumeStepCalc(a){var b=0;GUI.volume=parseInt($("#volume").val());var d=function(){b++,"up"===a?GUI.stepVolumeDelta=parseInt(GUI.volume)+b:"dn"===a&&(GUI.stepVolumeDelta=parseInt(GUI.volume)-b),$("#volume").val(GUI.stepVolumeDelta).trigger("change")};d(),GUI.stepVolumeInt=window.setInterval(function(){d()},200)}function volumeStepSet(){window.clearInterval(GUI.stepVolumeInt),setvol(GUI.stepVolumeDelta)}function customScroll(a,b,c){"undefined"==typeof c&&(c=500);var d=49,e=parseInt($(window).height()/2),f=$(window).scrollTop(),g=0,h=0;"db"===a?(g=parseInt(b*d-e),h=g):"pl"===a&&(g=parseInt((b+2)*d-e),h=Math.abs(g-f),h=(g>f?"+":"-")+"="+h+"px",$("#playlist-entries").find("li").eq(b).addClass("active")),$.scrollTo(g>0?h:0,c)}function randomScrollPL(){var a=$(".playlist li").size(),b=1+Math.floor(Math.random()*a);customScroll("pl",b)}function randomScrollDB(){var a=$(".database li").size(),b=1+Math.floor(Math.random()*a);customScroll("db",b)}function toggleLoader(a){"close"===a?$("#loader").addClass("hide"):$("#section-dev").length?($("#loader").addClass("hide"),new PNotify({title:"Warning",text:"The loading layer (spinning arrows) points to a socket error",icon:"fa fa-exclamation-circle"})):$("#loader").removeClass("hide")}function customNotify(a){"kernelswitch"===a.custom&&(void 0!==GUI.noticeUI.kernelswitch&&GUI.noticeUI.kernelswitch.remove(),GUI.noticeUI.kernelswitch=new PNotify({title:"title"in a?a.title:"[missing title]",text:"text"in a?a.text:"[missing text]",icon:"fa fa-refresh",hide:!1,confirm:{confirm:!0,buttons:[{text:a.btntext,addClass:"btn-default btn-block  uppercase",click:function(){$.post("/settings/",{syscmd:"reboot"}),toggleLoader()}},{text:"Cancel",addClass:"hide"}]},buttons:{closer:!1,sticker:!1}}))}function renderMSG(a){var b=a[0];if("custom"in b&&null!==b.custom)return customNotify(b),void 0;var c={title:"title"in b?b.title:"[missing title]",text:"text"in b?b.text:"[missing text]",icon:void 0===b.icon?"fa fa-check":b.icon,opacity:void 0===b.opacity?.9:b.opacity,hide:void 0===b.hide&&void 0===b.permanotice,buttons:{closer:void 0===b.permanotice,sticker:void 0===b.permanotice},delay:void 0===b.delay?8e3:b.delay,mouse_reset:!1};"permanotice"in b?void 0===GUI.noticeUI[b.permanotice]?GUI.noticeUI[b.permanotice]=new PNotify(c):"permaremove"in b?(GUI.noticeUI[b.permanotice].remove(),GUI.noticeUI[b.permanotice]=void 0):GUI.noticeUI[b.permanotice].open():new PNotify(c)}function sortOrder(a){var b=$("#"+a).index();a=parseInt(a.replace("pl-","")),sendCmd("moveid "+a+" "+b)}function loadingSpinner(a,b){"hide"===b?("db"===a&&$("#spinner-db").addClass("hide"),"pl"===a&&$("#spinner-pl").addClass("hide")):("db"===a&&$("#spinner-db").removeClass("hide"),"pl"===a&&$("#spinner-pl").removeClass("hide"))}function setPlaybackSource(){var a=GUI.libraryhome.ActivePlayer;$("#overlay-playsource-open button").text(a),$("#overlay-playsource a").addClass("inactive");var b=a.toLowerCase();$("#playsource-"+b).removeClass("inactive"),"Spotify"===a||"Airplay"===a?($("#volume").trigger("configure",{readOnly:!0,fgColor:"#1A242F"}).css({color:"#1A242F"}),$("#volume-knob").addClass("nomixer"),$("#volume-knob button").prop("disabled",!0),$("#single").addClass("disabled")):($("#volume").trigger("configure",{readOnly:!1,fgColor:"#0095D8"}).css({color:"#0095D8"}),$("#volume-knob").removeClass("nomixer"),$("#volume-knob button").prop("disabled",!1),$("#single").removeClass("disabled")),$("#playlist-entries").removeClass(function(a,b){return(b.match(/(^|\s)playlist-\S+/g)||[]).join(" ")}).addClass("playlist-"+b),$("#pl-manage").removeClass(function(a,b){return(b.match(/(^|\s)pl-manage-\S+/g)||[]).join(" ")}).addClass("pl-manage-"+b)}function chkKey(a){return void 0!==a&&""!==a}function renderLibraryHome(){loadingSpinner("db"),$("#database-entries").addClass("hide"),$("#db-level-up").addClass("hide"),$("#db-homeSetup").removeClass("hide").removeClass("btn-primary").addClass("btn-default"),$("#home-blocks").removeClass("hide");var a=GUI.libraryhome,b=0,c="",d='<div class="col-lg-3 col-md-4 col-sm-6">',e="</div>",f="",g="",h="Spotify"===a.ActivePlayer||"Airplay"===a.ActivePlayer;for(c='<div class="col-sm-12"><h1 class="txtmid">Browse your library</h1></div>',setPlaybackSource(),h&&(f=" inactive"),b=0;bookmark=a.bookmarks[b];b+=1)c+=d+'<div id="home-bookmark-'+bookmark.id+'" class="home-block home-bookmark'+f+'" data-path="'+bookmark.path+'"><i class="fa fa-star"></i><h3>'+bookmark.name+"</h3>bookmark</div>"+e;chkKey(a.networkMounts)&&(c+=0===a.networkMounts?h?d+'<div id="home-nas" class="home-block inactive"><i class="fa fa-sitemap"></i><h3>Network mounts (0)</h3>network attached storages</div>'+e:d+'<a class="home-block'+f+'" href="/sources/add/"><i class="fa fa-sitemap"></i><h3>Network mounts (0)</h3>click to add some</a>'+e:d+'<div id="home-nas" class="home-block'+f+'" data-path="NAS"><i class="fa fa-sitemap"></i><h3>Network mounts ('+a.networkMounts+")</h3>network attached storages</div>"+e),chkKey(a.localStorages)&&(c+=0===a.localStorages?"":d+'<div id="home-local" class="home-block'+f+'" data-path="LocalStorage"><i class="fa fa-hdd-o"></i><h3>LocalStorage ('+a.localStorages+")</h3>locally stored music</div>"+e),chkKey(a.USBMounts)&&(c+=0===a.USBMounts?h?d+'<div id="home-usb" class="home-block inactive"><i class="fa fa-hdd-o"></i><h3>USB storage (0)</h3>no USB storage plugged</div>'+e:d+'<a id="home-usb" class="home-block'+f+'" href="/sources"><i class="fa fa-hdd-o"></i><h3>USB storage (0)</h3>no USB storage plugged</a>'+e:d+'<div id="home-usb" class="home-block'+f+'" data-path="USB"><i class="fa fa-hdd-o"></i><h3>USB storage ('+a.USBMounts+")</h3>USB attached drives</div>"+e),chkKey(a.webradio)&&(c+=0===a.webradio?h?d+'<div id="home-webradio" class="home-block inactive"><i class="fa fa-microphone"></i><h3>My Webradios (0)</h3>webradio local playlists</div>'+e:d+'<a id="home-webradio" class="home-block'+f+'" href="#" data-toggle="modal" data-target="#modal-webradio-add"><i class="fa fa-microphone"></i><h3>My Webradios (0)</h3>click to add some</a>'+e:d+'<div id="home-webradio" class="home-block'+f+'" data-path="Webradio"><i class="fa fa-microphone"></i><h3>My Webradios ('+a.webradio+")</h3>webradio local playlists</div>"+e),chkKey(a.podcast)&&(c+=0===a.podcast?h?d+'<div id="home-podcast" class="home-block inactive"><i class="fa fa-rss"></i><h3>My Podcasts (0)</h3>podcasts</div>'+e:d+'<a id="home-podcast" class="home-block'+f+'" href="#" data-toggle="modal" data-target="#modal-podcast-add"><i class="fa fa-rss"></i><h3>My Podcasts (0)</h3>click to add some</a>'+e:d+'<div id="home-podcast" class="home-block'+f+'" data-plugin="Podcast" data-path="Podcast"><i class="fa fa-rss"></i><h3>My Podcasts ('+a.podcast+")</h3>podcasts</div>"+e),chkKey(a.Spotify)&&(c+="0"===a.Spotify?d+'<a id="home-spotify" class="home-block'+g+'" href="/settings/#features-management"><i class="fa fa-spotify"></i><h3>Spotify<span id="home-count-spotify"></span></h3>click to configure</a>'+e:"Spotify"!==a.ActivePlayer?d+'<div id="home-spotify-switch" class="home-block"><i class="fa fa-spotify"></i><h3>Spotify</h3>click to switch renderer</div>'+e:d+'<div id="home-spotify" class="home-block'+g+'" data-plugin="Spotify" data-path="Spotify"><i class="fa fa-spotify"></i><h3>Spotify</h3>music for everyone</div>'+e),chkKey(a.Dirble)&&(c+=d+'<div id="home-dirble" class="home-block'+f+'" data-plugin="Dirble" data-path="Dirble"><i class="fa fa-globe"></i><h3>Dirble <span id="home-count-dirble">('+a.Dirble+")</span></h3>radio stations open directory</div>"+e),c+=d+'<div id="home-jamendo" class="home-block'+f+'" data-plugin="Jamendo" data-path="Jamendo"><i class="fa fa-play-circle-o"></i><h3>Jamendo<span id="home-count-jamendo"></span></h3>world\'s largest platform for free music</div>'+e,c+=d+'<div id="home-albums" class="home-block'+f+'" data-path="Albums" data-browsemode="album"><i class="fa fa-dot-circle-o"></i><h3>Albums</h3>browse MPD database by album</div>'+e,c+=d+'<div id="home-artists" class="home-block'+f+'" data-path="Artists" data-browsemode="artist"><i class="fa fa-users"></i><h3>Artists</h3>browse MPD database by artist</div>'+e,c+=d+'<div id="home-genre" class="home-block'+f+'" data-path="Genres" data-browsemode="genre"><i class="fa fa-tags"></i><h3>Genres</h3>browse MPD database by genre</div>'+e,c+="</div>",document.getElementById("home-blocks").innerHTML=c,loadingSpinner("db","hide"),$("span","#db-currentpath").html("")}function refreshState(){var a=GUI.state;if("play"===a?($("#play").addClass("btn-primary"),$("i","#play").removeClass("fa fa-pause").addClass("fa fa-play"),$("#stop").removeClass("btn-primary")):"pause"===a?($("#playlist-position span").html("Not playing"),$("#play").addClass("btn-primary"),$("i","#play").removeClass("fa fa-play").addClass("fa fa-pause"),$("#stop").removeClass("btn-primary")):"stop"===a&&($("#play").removeClass("btn-primary"),$("i","#play").removeClass("fa fa-pause").addClass("fa fa-play"),$("#stop").addClass("btn-primary"),$("#section-index").length&&$("#countdown-display").countdown("destroy"),"radio"===GUI.stream?$("#total").html("<span>&infin;</span>"):$("#total").html("00:00"),$("#time").val(0,!1).trigger("update"),$("#format-bitrate").html("&nbsp;"),$("li","#playlist-entries").removeClass("active")),"stop"!==a){"radio"===GUI.stream?$("#total").html("<span>&infin;</span>"):$("#total").html(void 0!==GUI.json.time?timeConvert(GUI.json.time):"00:00");var b=GUI.json.audio_channels&&GUI.json.audio_sample_depth&&GUI.json.audio_sample_rate?GUI.json.audio_channels+", "+GUI.json.audio_sample_depth+" bit, "+GUI.json.audio_sample_rate+" kHz, "+GUI.json.bitrate+" kbps":"&nbsp;";$("#format-bitrate").html(b),$("li","#playlist-entries").removeClass("active");var c=parseInt(GUI.json.song);$("#playlist-entries").find("li").eq(c).addClass("active")}GUI.json.playlistlength&&"0"!==GUI.json.playlistlength?GUI.json.song?$("#playlist-position span").html("Playlist position "+(parseInt(GUI.json.song)+1)+"/"+GUI.json.playlistlength):$("#playlist-position span").html("Playlist position 1/"+GUI.json.playlistlength):$("#playlist-position span").html("Empty queue, add some music!"),void 0!==GUI.json.updating_db?$("a","#open-panel-sx").html('<i class="fa fa-refresh fa-spin"></i> Updating'):$("a","#open-panel-sx").html('<i class="fa fa-music sx"></i> Library')}function updateGUI(){var a=GUI.json.volume,b=GUI.json.radioname,c=GUI.json.currentartist,d=GUI.json.currentsong,e=GUI.json.currentalbum;if(GUI.stream=null!==b&&void 0!==b&&""!==b?"radio":"",refreshState(),$("#section-index").length){if(GUI.currentsong!==GUI.json.currentsong&&(countdownRestart(0),$("#panel-dx").hasClass("active"))){var f=parseInt(GUI.json.song);customScroll("pl",f)}$("#volume").val("-1"===a?100:a,!1).trigger("update"),"radio"!==GUI.stream?($("#currentartist").html(null===c||void 0===c||""===c?'<span class="notag">[no artist]</span>':c),$("#currentsong").html(null===d||void 0===d||""===d?'<span class="notag">[no title]</span>':d),$("#currentalbum").html(null===e||void 0===e||""===e?'<span class="notag">[no album]</span>':e)):($("#currentartist").html(null===c||void 0===c||""===c?b:c),$("#currentsong").html(null===d||void 0===d||""===d?b:d),$("#currentalbum").html('<span class="notag">streaming</span>')),"1"===GUI.json.repeat?$("#repeat").addClass("btn-primary"):$("#repeat").removeClass("btn-primary"),"1"===GUI.json.random?$("#random").addClass("btn-primary"):$("#random").removeClass("btn-primary"),"1"===GUI.json.consume?$("#consume").addClass("btn-primary"):$("#consume").removeClass("btn-primary"),"1"===GUI.json.single?$("#single").addClass("btn-primary"):$("#single").removeClass("btn-primary"),GUI.currentsong=d;var g=c+" - "+e;if(GUI.currentalbum!==g)if(null===b||void 0===b||""===b){var h=Math.floor(1001*Math.random());$("#cover-art").css("background-image",'url("/coverart/?v='+h+'")')}else $("#cover-art").css("background-image",'url("assets/img/cover-radio.jpg")');GUI.currentalbum=g}}function getPlaylistPlain(a){var r,s,b=parseInt(GUI.json.song)+1,c=GUI.json.state,d="",e="",f="",g="",h="",i="",j="",k="",l="",n="",o="",p="",q=0,t=a.split("\n"),u=[];for(r=0;s=t[r];r+=1)u=s.split(": "),"Time"===u[0]?e=parseInt(u[1]):"Artist"===u[0]?f=u[1]:"Title"===u[0]?h=u[1]:"Name"===u[0]?i=u[1]:"Album"===u[0]?g=u[1]:"file"===u[0]?j=u[1]:"Id"===u[0]&&(n=u[1],""===h||""===g?(l=parsePath(j),k=j.split("/").pop(),h=k,o=""===f?"path: "+l:f):o=f+" - "+g,""!==i?(h='<i class="fa fa-microphone"></i>'+i,o=j,p=""):p="<span>"+timeConvert2(e)+"</span>",q++,d+='<li id="pl-'+n+'"'+("stop"!==c&&q===b?' class="active"':"")+'><i class="fa fa-times-circle pl-action" title="Remove song from playlist"></i><span class="sn">'+h+p+'</span><span class="bl">'+o+"</span></li>",e="",f="",g="",h="",i="");$(".playlist").addClass("hide"),$("#playlist-entries").removeClass("hide");var v=document.getElementById("playlist-entries");v&&(v.innerHTML=d),$("#pl-filter-results").addClass("hide").html(""),$("#pl-filter").val(""),$("#pl-manage").removeClass("hide"),$("#pl-count").removeClass("hide").html(q+(1!==q?" entries":" entry"))}function getPlaylistCmd(){loadingSpinner("pl"),$.ajax({url:"/db/?cmd=playlist",success:function(a){if(a.length>4){$(".playlist").addClass("hide"),$("#playlist-entries").removeClass("hide"),getPlaylistPlain(a);var b=parseInt(GUI.json.song);$("#panel-dx").hasClass("active")&&GUI.currentsong!==GUI.json.currentsong&&customScroll("pl",b,200)}else $(".playlist").addClass("hide"),$("#playlist-warning").removeClass("hide"),$("#pl-filter-results").addClass("hide").html(""),$("#pl-count").removeClass("hide").html("0 entries");loadingSpinner("pl","hide")}})}function getPlaylist(a){if(data=a[0],data.length>4){$(".playlist").addClass("hide"),$("#playlist-entries").removeClass("hide"),getPlaylistPlain(data);var b=parseInt(GUI.json.song);$("#panel-dx").hasClass("active")&&GUI.currentsong!==GUI.json.currentsong&&customScroll("pl",b,200)}else $(".playlist").addClass("hide"),$("#playlist-warning").removeClass("hide"),$("#pl-filter-results").addClass("hide").html(""),$("#pl-count").removeClass("hide").html("0 entries");loadingSpinner("pl","hide")}function renderUI(a){if(toggleLoader("close"),GUI.json=a[0],console.log(JSON.stringify(a[0])),GUI.state=GUI.json.state,updateGUI(),$("#section-index").length){var b=""!==GUI.json.elapsed&&void 0!==GUI.json.elapsed?GUI.json.elapsed:0,c=""!==GUI.json.time&&void 0!==GUI.json.time&&null!==GUI.json.time?GUI.json.time:0;refreshTimer(parseInt(b),parseInt(c),GUI.json.state),"radio"!==GUI.stream?refreshKnob():$("#time").val(0,!1).trigger("update"),GUI.json.playlist!==GUI.playlist&&(getPlaylistCmd(),GUI.playlist=GUI.json.playlist)}}function renderPlaylists(a){var d,e,b="",c="",f=a.split("\n"),g=[];for(d=0;e=f[d];d+=1)g=e.split(": "),"playlist"===g[0]&&(c=g[1],b+='<li class="pl-folder" data-path="'+c+'"><i class="fa fa-bars pl-action" data-target="#context-menu-playlist" data-toggle="context" title="Actions"></i><span><i class="fa fa-list-ol"></i>'+c+"</span></li>",c="");document.getElementById("playlist-entries").innerHTML="",$(".playlist").addClass("hide"),$("#pl-manage").addClass("hide"),$("#pl-count").addClass("hide"),$("#pl-filter-results").removeClass("hide").addClass("back-to-queue").html('<i class="fa fa-arrow-left sx"></i> to queue'),$("#pl-currentpath").removeClass("hide"),$("#pl-editor").removeClass("hide"),document.getElementById("pl-editor").innerHTML=b,loadingSpinner("pl","hide")}function getPlaylists(){loadingSpinner("pl"),$.ajax({url:"/command/?cmd=listplaylists",success:function(a){renderPlaylists(a)}})}function parseResponse(a){var b=a.inputArr||"",c=a.respType||"",d=a.i||0,e=a.inpath||"",f=a.querytype||"",g="";switch(c){case"playlist":break;case"db":"file"===GUI.browsemode?(""===e&&void 0!==b.file&&(e=parsePath(b.file)),void 0!==b.file||"Webradio"===e?(g='<li id="db-'+(d+1)+'" data-path="',void 0!==b.Title?(g+=b.file,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-music db-icon"></i><span class="sn">',g+=b.Title+" <span>"+timeConvert(b.Time)+"</span></span>",g+=' <span class="bl">',g+=b.Artist,g+=" - ",g+=b.Album):"Webradio"!==e?(g+=b.file,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-music db-icon"></i><span class="sn">',g+=b.file.replace(e+"/","")+" <span>"+timeConvert(b.Time)+"</span></span>",g+='<span class="bl">',g+=" path: ",g+=e):(g+=b.playlist,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-webradio"></i><i class="fa fa-microphone db-icon db-radio"></i>',g+='<span class="sn">'+b.playlist.replace(e+"/","").replace("."+b.fileext,""),g+='</span><span class="bl">webradio'),g+="</span></li>"):void 0!==b.playlist?"cue"===b.fileext&&(g='<li id="db-'+(d+1)+'" data-path="',g+=b.playlist,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-file-text db-icon"></i><span class="sn">',g+=b.playlist.replace(e+"/","")+" <span>[CUE file]</span></span>",g+='<span class="bl">',g+=" path: ",g+=e,g+="</span></li>"):(g='<li id="db-'+(d+1)+'" class="db-folder" data-path="',g+=b.directory,g+=""!==e?'"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu"></i><span><i class="fa fa-folder-open"></i>':'"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-root"></i><i class="fa fa-hdd-o icon-root"></i><span>',g+=b.directory.replace(e+"/",""),g+="</span></li>")):"album"===GUI.browsemode||"albumfilter"===GUI.browsemode?void 0!==b.file?(g='<li id="db-'+(d+1)+'" data-path="',g+=b.file,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-music db-icon"></i><span class="sn">',g+=b.Title+" <span>"+timeConvert(b.Time)+"</span></span>",g+=' <span class="bl">',g+=b.Artist,g+=" - ",g+=b.Album,g+="</span></li>"):""!==b.album&&(g='<li id="db-'+(d+1)+'" class="db-folder db-album" data-path="',g+=b.album.replace(/\"/g,"&quot;"),g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-album"></i><span><i class="fa fa-dot-circle-o"></i>',g+=b.album,g+="</span></li>"):"artist"===GUI.browsemode?void 0!==b.album?(g='<li id="db-'+(d+1)+'" class="db-folder db-album" data-path="',g+=b.album,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-album"></i><span><i class="fa fa-dot-circle-o"></i>',g+=""!==b.album?b.album:"Unknown album",g+="</span></li>"):""!==b.artist&&(g='<li id="db-'+(d+1)+'" class="db-folder db-artist" data-path="',g+=b.artist,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu"></i><span><i class="fa fa-user"></i>',g+=b.artist,g+="</span></li>"):"genre"===GUI.browsemode&&(void 0!==b.artist?(g='<li id="db-'+(d+1)+'" class="db-folder db-artist" data-path="',g+=b.artist,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-artist"></i><span><i class="fa fa-dot-circle-o"></i>',g+=""!==b.artist?b.artist:"Unknown artist",g+="</span></li>"):""!==b.genre&&(g='<li id="db-'+(d+1)+'" class="db-folder db-genre" data-path="',g+=b.genre,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu"></i><span><i class="fa fa-tags"></i>',g+=b.genre,g+="</span></li>"));break;case"Spotify":""===f?(g='<li id="db-'+(d+1)+'" class="db-spotify db-folder" data-path="',g+=b.index,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-spotify-pl"></i><span><i class="fa fa-folder-open"></i>',g+=""!==b.name?b.name:"Favorites",g+=" (",g+=b.tracks,g+=")</span></li>"):"tracks"===f&&(g='<li id="db-'+(d+1)+'" class="db-spotify" data-path="',g+=b.index,g+='" data-plid="',g+=e,g+='" data-type="spotify-track"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-spotify"></i><i class="fa fa-spotify db-icon"></i><span class="sn">',g+=b.title+" <span>"+timeConvert(b.duration/1e3)+"</span></span>",g+=' <span class="bl">',g+=b.artist,g+=" - ",g+=b.album,g+="</span></li>");break;case"Dirble":if(""===f||"childs"===f){var h="childs"===f?" db-dirble-child":"";g='<li id="db-'+(d+1)+'" class="db-dirble db-folder'+h+'" data-path="',g+=b.id,g+='"><span><i class="fa fa-folder-open"></i>',g+=b.title,g+="</span></li>"}else if("stations"===f){if(0===b.streams.length)break;g='<li id="db-'+(d+1)+'" class="db-dirble db-radio" data-path="',g+=b.name+" | "+b.streams[0].stream,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-dirble"></i><i class="fa fa-microphone db-icon"></i>',g+='<span class="sn">'+b.name+"<span>("+b.country+")</span></span>",g+='<span class="bl">',g+=b.website?b.website:"-no website-",g+="</span></li>"}break;case"Jamendo":g='<li id="db-'+(d+1)+'" class="db-jamendo db-folder" data-path="',g+=b.stream,g+='"><img class="jamendo-cover" src="/tun/'+b.image+'" alt=""><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i>',g+=b.dispname+"</div></li>";break;case"Podcast":""===f?(g='<li id="db-'+(d+1)+'" class="db-podcast db-folderradio" data-path="',g+=b.name+" | "+b.url,g+='"><img class="jamendo-cover" src="'+b.image+'" alt=""><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-podcast-pl"></i>',g+='<span class="sn">'+b.name+"</span>",g+='<span class="bl">',g+=b.description,g+="</span></li>"):"content"===f&&(g='<li id="db-'+(d+1)+'" class="db-podcast db-radio" data-path="',g+=b.enclosure,g+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-podcast"></i><i class="fa fa-microphone db-icon"></i>',g+='<span class="sn">'+b.title+"</span>",g+='<span class="bl">',g+=b.description,g+="</span></li>")}return g}function populateDB(a){var b=a.data||"",c=a.path||"",d=a.uplevel||0,e=a.keyword||"",f=a.plugin||"",g=a.querytype||"",h=a.args||"",i="",j=0,k=[];if(console.log(JSON.stringify(b)),""!==f){if("Spotify"===f){for($("#database-entries").removeClass("hide"),$("#db-level-up").removeClass("hide"),$("#home-blocks").addClass("hide"),c&&(GUI.currentpath=c),document.getElementById("database-entries").innerHTML="",b="tracks"===g?b.tracks:b.playlists,j=0;k=b[j];j+=1)i+=parseResponse({inputArr:k,respType:"Spotify",i:j,querytype:g,inpath:h});document.getElementById("database-entries").innerHTML=i}if("Dirble"===f){for($("#database-entries").removeClass("hide"),$("#db-level-up").removeClass("hide"),$("#home-blocks").addClass("hide"),c&&(GUI.currentpath=c),document.getElementById("database-entries").innerHTML="",j=0;k=b[j];j+=1)i+=parseResponse({inputArr:k,respType:"Dirble",i:j,querytype:g});document.getElementById("database-entries").innerHTML=i}if("Jamendo"===f){for($("#database-entries").removeClass("hide"),$("#db-level-up").removeClass("hide"),$("#home-blocks").addClass("hide"),c&&(GUI.currentpath=c),document.getElementById("database-entries").innerHTML="",j=0;k=b[j];j+=1)i+=parseResponse({inputArr:k,respType:"Jamendo",i:j,querytype:g});document.getElementById("database-entries").innerHTML=i}if("Podcast"===f){for($("#database-entries").removeClass("hide"),$("#db-level-up").removeClass("hide"),$("#home-blocks").addClass("hide"),c&&(GUI.currentpath=c),document.getElementById("database-entries").innerHTML="",j=0;k=b[j];j+=1)i+=parseResponse({inputArr:k,respType:"Podcast",i:j,querytype:g,inpath:c});""===g&&(i+='<li id="podcast-add" class="db-podcast-add"><i class="fa fa-plus-circle db-icon"></i><span class="sn"><em>add new</em></span><span class="bl">add a podcast to your library</span></li>'),document.getElementById("database-entries").innerHTML=i}}else{if(""===c&&""===e)return renderLibraryHome(),void 0;if($("#database-entries").removeClass("hide"),$("#db-level-up").removeClass("hide"),$("#home-blocks").addClass("hide"),c&&(GUI.currentpath=c),document.getElementById("database-entries").innerHTML="",""!==e){var l=b.length?b.length:"0",m=1===b.length?"":"s";$("#db-level-up").addClass("hide"),$("#db-search-results").removeClass("hide").html('<i class="fa fa-times sx"></i><span class="visible-xs-inline">back</span><span class="hidden-xs">'+l+" result"+m+' for "<span class="keyword">'+e+'</span>"</span>')}for(j=0;k=b[j];j+=1)i+=parseResponse({inputArr:k,respType:"db",i:j,inpath:c});"Webradio"===c&&(i+='<li id="webradio-add" class="db-webradio-add"><i class="fa fa-plus-circle db-icon"></i><span class="sn"><em>add new</em></span><span class="bl">add a webradio to your library</span></li>'),document.getElementById("database-entries").innerHTML=i}var n=$("span","#db-currentpath");if("album"===GUI.browsemode?"Albums"===c?n.html(c):n.html("Albums/"+c):"artist"===GUI.browsemode?"Artists"===c?n.html(c):n.html("Artists/"+c):"genre"===GUI.browsemode?"Genres"===c?n.html(c):n.html("Genres/"+c):n.html(c),$("#db-homeSetup").addClass("hide"),d){var o=GUI.currentDBpos[GUI.currentDBpos[10]];$("#db-"+o).addClass("active"),customScroll("db",o,0)}else customScroll("db",0,0);loadingSpinner("db","hide")}function getDB(a){var b=a.cmd||"browse",c=a.path||"",d=a.browsemode||"file",e=a.uplevel||"",f=a.plugin||"",g=a.querytype||"",h=a.args||"";if(loadingSpinner("db"),GUI.browsemode=d,""!==f)"Spotify"===f?$.post("/db/?cmd=spotify",{plid:h},function(a){populateDB({data:a,path:c,plugin:f,querytype:g,uplevel:e,args:h})},"json"):"Dirble"===f?$.post("/db/?cmd=dirble",{querytype:""===g?"categories":g,args:h},function(a){populateDB({data:a,path:c,plugin:f,querytype:g,uplevel:e})},"json"):"Jamendo"===f?$.post("/db/?cmd=jamendo",{querytype:""===g?"radio":g,args:h},function(a){populateDB({data:a.results,path:c,plugin:f,querytype:g})},"json"):"Podcast"===f&&(h=h.split(" | ")[1],$.post("/db/?cmd=podcast",{querytype:""===g?"list":g,args:h},function(a){populateDB({data:a.results,path:c,plugin:f,querytype:g})},"json"));else if("search"===b){var i=$("#db-search-keyword").val();$.post("/db/?querytype="+GUI.browsemode+"&cmd=search",{query:i},function(a){populateDB({data:a,path:c,uplevel:e,keyword:i})},"json")}else"browse"===b?$.post("/db/?cmd=browse",{path:c,browsemode:GUI.browsemode},function(a){populateDB({data:a,path:c,uplevel:e})},"json"):(loadingSpinner("db","hide"),$.post("/db/?cmd="+b,{path:c,querytype:g},function(){},"json"))}function onreleaseKnob(a){if("stop"!==GUI.state&&""!==GUI.state)if("radio"!==GUI.stream){window.clearInterval(GUI.currentKnob);var b=Math.floor(a*parseInt(GUI.json.time)/1e3);sendCmd("seek "+GUI.json.song+" "+b),$("#time").val(a),$("#countdown-display").countdown("destroy"),$("#countdown-display").countdown({since:-b,compact:!0,format:"MS"})}else $("#time").val(0).trigger("change")}function commandButton(a){var c,b=a.data("cmd");if("stop"===b)a.addClass("btn-primary"),$("#play").removeClass("btn-primary"),$("#section-index").length&&(refreshTimer(0,0,"stop"),window.clearInterval(GUI.currentKnob),$(".playlist").find("li").removeClass("active"),$("#total").html("00:00"));else{if("play"===b){var d=GUI.state;return"play"===d?(c="pause",$("#section-index").length&&$("#countdown-display").countdown("pause")):"pause"===d?(c="play",$("#section-index").length&&$("#countdown-display").countdown("resume")):"stop"===d&&(c="play",$("#section-index").length&&$("#countdown-display").countdown({since:0,compact:!0,format:"MS"})),window.clearInterval(GUI.currentKnob),sendCmd(c),void 0}if("previous"===b||"next"===b)$("#section-index").length&&($("#countdown-display").countdown("pause"),window.clearInterval(GUI.currentKnob));else if(a.hasClass("btn-volume")){var e,f=parseInt($("#volume").val());return null===GUI.volume&&(GUI.volume=f),"volumedn"===b&&parseInt(GUI.volume)>0?(e=parseInt(GUI.volume)-1,GUI.volume=e,$("#volumemute").removeClass("btn-primary")):"volumeup"===b&&parseInt(GUI.volume)<100?(e=parseInt(GUI.volume)+1,GUI.volume=e,$("#volumemute").removeClass("btn-primary")):"volumemute"===b&&(0!==f?(GUI.volume=f,a.addClass("btn-primary"),e=0):(a.removeClass("btn-primary"),setvol(GUI.volume))),e>=0&&100>=e&&sendCmd("setvol "+e),void 0}}a.hasClass("btn-toggle")?(c=b+(a.hasClass("btn-primary")?" 0":" 1"),a.toggleClass("btn-primary")):c=b,sendCmd(c)}function libraryHome(a){GUI.libraryhome=a[0],renderLibraryHome()}function listWLANs(a){var c="",d="",e="",f=a[0];$.each(f,function(a){c+='<p><a href="/network/wlan/'+f[a].nic+"/"+f[a].ESSID+'" class="btn btn-lg btn-default btn-block" title="See network properties">',0!==f[a].connected&&(c+='<i class="fa fa-check green sx"></i>'),1===f[a].storedprofile&&"on"===f[a].encryption?c+='<i class="fa fa-lock sx"></i>':"on"===f[a].encryption?c+='<i class="fa fa-rss fa-wifi"></i><i class="fa fa-lock sx"></i>':1!==f[a].storedprofile&&(c+='<i class="fa fa-rss fa-wifi sx"></i>'),c+="<strong>"+f[a].ESSID+"</strong></a></p>","scan"===f[a].origin&&(d+=c),1===f[a].storedprofile&&(e+=c),c=""}),""===d&&(d='<p><a class="btn btn-lg btn-default btn-block" href="#"><i class="fa fa-cog fa-spin sx"></i>scanning for networks...</a></p>'),document.getElementById("wifiNetworks").innerHTML=d,document.getElementById("wifiStored").innerHTML=e,$.ajax({url:"/command/?cmd=wifiscan"})}function nicsDetails(a){var c="",d=a[0];$.each(d,function(a){a===$("#nic-details").data("name")&&(c+="<tr><th>Name:</th><td><strong>"+a+"<strong></td></tr>",c+="<tr><th>Type:</th><td>wireless</td></tr>",null===d[a].currentssid?c+='<tr><th>Status:</th><td><i class="fa fa-times red sx"></i>no network connected</td></tr>':(c+='<tr><th>Status:</th><td><i class="fa fa-check green sx"></i>connected</td></tr>',c+="<tr><th>Associated SSID:</th><td><strong>"+d[a].currentssid+"</strong></td></tr>"),c+="<tr><th>Assigned IP:</th><td>"+(null!==d[a].ip?"<strong>"+d[a].ip+"</strong>":"none")+"</td></tr>",c+="<tr><th>Speed:</th><td>"+(null!==d[a].speed?d[a].speed:"unknown")+"</td></tr>",null!==d[a].currentssid&&(c+="<tr><th>Netmask:</th><td>"+d[a].netmask+"</td></tr>",c+="<tr><th>Gateway:</th><td>"+d[a].gw+"</td></tr>",c+="<tr><th>DNS1:</th><td>"+d[a].dns1+"</td></tr>",c+="<tr><th>DNS2:</th><td>"+d[a].dns2+"</td></tr>"))}),$("#nic-details tbody").html(c)}function playbackChannel(){var a=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode,reconnectOnChannelUnavailableInterval:5e3});a.onmessage=renderUI,a.onstatuschange=function(a){2===a?($("#loader").addClass("hide"),sendCmd("renderui")):0===a&&toggleLoader()
},a.addChannel("playback"),a.connect()}function queueChannel(){var a=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});a.onmessage=getPlaylist,a.addChannel("queue"),a.connect()}function libraryChannel(){var a=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});a.onmessage=libraryHome,a.addChannel("library"),a.connect()}function notifyChannel(){var a=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});a.onmessage=renderMSG,a.addChannel("notify"),a.connect()}function wlansChannel(){var a=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});a.onmessage=listWLANs,a.addChannel("wlans"),a.connect(),$.ajax({url:"/command/?cmd=wifiscan"})}function nicsChannel(){var a=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});a.onmessage=nicsDetails,a.addChannel("nics"),a.connect()}function overlayTrigger(a){function e(){if(b.hasClass("open"))b.removeClass("open"),b.addClass("closed");else if(b.hasClass("closed")&&(b.addClass("open"),"#overlay-social"===a)){var d="https://twitter.com/home?status=Listening+to+"+GUI.json.currentsong.replace(/\s+/g,"+")+"+by+"+GUI.json.currentartist.replace(/\s+/g,"+")+"+on+%40RuneAudio+http%3A%2F%2Fwww.runeaudio.com%2F+%23nowplaying",e="https://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.runeaudio.com%2F&display=popup",f="https://plus.google.com/share?url=http%3A%2F%2Fwww.runeaudio.com%2F";$("#urlTwitter").attr("href",d),$("#urlFacebook").attr("href",e),$("#urlGooglePlus").attr("href",f)}}var b=$(a),c=$(a+"-open"),d=$(a+"-close");transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},c.click(function(){e()}),d.click(function(){e()})}function getHiddenProp(){var a=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var b=0;b<a.length;b++)if(a[b]+"Hidden"in document)return a[b]+"Hidden";return null}function isHidden(){var a=getHiddenProp();return a?document[a]:!1}function visChange(){GUI.visibility=isHidden()?"hidden":"visible"}var GUI={DBentry:["","",""],DBupdate:0,activePlayer:"",browsemode:"file",currentDBpos:[0,0,0,0,0,0,0,0,0,0,0],currentDBpath:["","","","","","","","","","",""],currentalbum:null,currentknob:null,currentpath:"",currentsong:null,json:0,libraryhome:"",mode:"websocket",noticeUI:{},playlist:null,plugin:"",state:"",stepVolumeDelta:0,stepVolumeInt:0,stream:"",visibility:"visible",volume:null};$("#section-index").length?jQuery(document).ready(function(a){"use strict";GUI.mode=checkWebSocket(),playbackChannel(),libraryChannel(),PNotify.prototype.options.styling="fontawesome",PNotify.prototype.options.stack.dir1="up",PNotify.prototype.options.stack.dir2="left",PNotify.prototype.options.stack.firstpos1=90,PNotify.prototype.options.stack.firstpos2=50,PNotify.prototype.options.stack.spacing1=10,PNotify.prototype.options.stack.spacing2=10,notifyChannel();var b=getHiddenProp();if(b){var c=b.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(c,visChange)}a(".btn-cmd").click(function(){var b=a(this);commandButton(b)}),a("#volume-step-dn").on({mousedown:function(){volumeStepCalc("dn")},mouseup:function(){volumeStepSet()}}),a("#volume-step-up").on({mousedown:function(){volumeStepCalc("up")},mouseup:function(){volumeStepSet()}}),a("#countdown-display").click(function(){sendCmd("pause")}),a("#total").click(function(){sendCmd("pause")}),a("#time").knob({inline:!1,change:function(){"stop"!==GUI.state?window.clearInterval(GUI.currentKnob):a("#time").val(0).trigger("change")},release:function(a){onreleaseKnob(a)}}),a("#volume").knob({inline:!1,change:function(){},release:function(a){setvol(a)},draw:function(){if("tron"===this.$.data("skin")){this.cursorExt=.05;var b,a=this.arc(this.cv),c=1;return this.g.lineWidth=this.lineWidth,this.o.displayPrevious&&(b=this.arc(this.v),this.g.beginPath(),this.g.strokeStyle=this.pColor,this.g.arc(this.xy,this.xy,this.radius-this.lineWidth,b.s,b.e,b.d),this.g.stroke()),this.g.beginPath(),this.g.strokeStyle=c?this.o.fgColor:this.fgColor,this.g.arc(this.xy,this.xy,this.radius-this.lineWidth,a.s,a.e,a.d),this.g.stroke(),this.g.lineWidth=2,this.g.beginPath(),this.g.strokeStyle=this.o.fgColor,this.g.arc(this.xy,this.xy,this.radius-this.lineWidth+13+this.lineWidth,0,2*Math.PI,!1),this.g.stroke(),!1}}});var d=a("#playlist-entries");d.on("click","li",function(b){var c="";if(a(b.target).hasClass("pl-action")){b.preventDefault();var d=a(this).attr("id");d=parseInt(d.replace("pl-","")),c="deleteid "+d,sendCmd(c)}else{var e=a("li","#playlist-entries").index(this);c="play "+e,sendCmd(c),a("li.active","#playlist-entries").removeClass("active"),a(this).addClass("active")}}),a("a","#open-panel-dx").click(function(){if(a("#open-panel-dx").hasClass("active")){var b=parseInt(GUI.json.song);customScroll("pl",b,500)}}).on("shown.bs.tab",function(){var b=parseInt(GUI.json.song);customScroll("pl",b,0)}),a("#open-library").click(function(){a("#open-panel-dx").removeClass("active"),a("#open-panel-sx").addClass("active")}),a("#pl-filter").keyup(function(){a.scrollTo(0,500);var b=a(this).val(),c=0;a("li","#playlist-entries").each(function(){var d=a(this);d.text().search(new RegExp(b,"i"))<0?d.hide():(d.show(),c++)});var e=1===c?"":"s";""!==b?(a("#pl-count").addClass("hide"),a("#pl-filter-results").removeClass("hide").html('<i class="fa fa-times sx"></i><span class="visible-xs-inline">back</span><span class="hidden-xs">'+ +c+" result"+e+' for "<span class="keyword">'+b+'</span>"</span>')):(a("#pl-count").removeClass("hide"),a("#pl-filter-results").addClass("hide").html(""))}),a("#pl-filter-results").click(function(){a(this).addClass("hide"),a("#pl-count").removeClass("hide"),a(this).hasClass("back-to-queue")?(a(".playlist").addClass("hide"),getPlaylistCmd(),a("#pl-currentpath").addClass("hide"),a("#pl-manage").removeClass("hide")):(a("li","#playlist-entries").each(function(){var b=a(this);b.show()}),a("#pl-currentpath").removeClass("hide"),a("#pl-filter").val("")),customScroll("pl",parseInt(GUI.json.song),500)}),a("#pl-manage-list").click(function(){getPlaylists()}),a("#modal-pl-save-btn").click(function(){var b=a("#pl-save-name").val();sendCmd('save "'+b+'"')}),a("#pl-editor").on("click",".pl-action",function(b){b.preventDefault();var c=a(this).parent().attr("data-path");GUI.DBentry[0]=c}),a("#pl-rename-button").click(function(){var b=a("#pl-rename-oldname").text(),c=a("#pl-rename-name").val();sendCmd('rename "'+b+'" "'+c+'"'),getPlaylists()});var e=document.getElementById("playlist-entries");new Sortable(e,{ghostClass:"sortable-ghost",onUpdate:function(a){sortOrder(a.item.getAttribute("id"))}}),a("a","#open-panel-sx").click(function(){a("#open-panel-sx").hasClass("active")&&customScroll("pl",parseInt(GUI.json.song),500)}).on("shown.bs.tab",function(){customScroll("db",GUI.currentDBpos[GUI.currentDBpos[10]],0)}),a("#home-blocks").on("click",".home-block",function(b){if(a(this).hasClass("inactive"))a("#overlay-playsource-open").trigger("click");else if(a(this).is("#home-spotify-switch"))a("#overlay-playsource-open").trigger("click");else if(a(b.target).is("span.block-remove")){var c=a(this).attr("id");c=c.replace("home-bookmark-","");var d=a(this).find("h3").text();a.post("/db/?cmd=bookmark",{id:c,name:d})}else++GUI.currentDBpos[10],getDB({browsemode:a(this).data("browsemode"),path:a(this).data("path"),uplevel:0,plugin:a(this).data("plugin")})}),a("#db-homeSetup").click(function(){var b=a(this);b.hasClass("btn-primary")?(b.removeClass("btn-primary").addClass("btn-default"),a(".home-block-remove").remove()):(b.removeClass("btn-default").addClass("btn-primary"),a(".home-block.home-bookmark").append('<div class="home-block-remove" title="Remove this bookmark"><span class="block-remove">&times;</span></div>'))});var f=a("#database-entries");f.on("click","li",function(b){var c="",d="",e=a(this);if(a(b.target).hasClass("db-action"))b.preventDefault(),c="spotify-track"===e.data("type")?e.data("plid")+"-"+e.data("path"):e.data("path"),GUI.DBentry[0]=c;else if(a("li.active","#database-entries").removeClass("active"),e.addClass("active"),e.hasClass("db-folder")||e.hasClass("db-folderradio")){if(c=e.data("path"),e.hasClass("db-album"))""!==c?getDB({path:c,uplevel:0,browsemode:"album"}):(c=GUI.currentDBpath[GUI.currentDBpos[10]-1],getDB({path:c,uplevel:0,browsemode:"albumfilter"}));else if(e.hasClass("db-artist"))getDB({path:c,uplevel:0,browsemode:"artist"});else if(e.hasClass("db-genre"))getDB({path:c,uplevel:0,browsemode:"genre"});else if(e.hasClass("db-spotify"))c=GUI.currentpath+"/"+e.find("span").text(),getDB({path:c,plugin:"Spotify",args:e.data("path").toString(),querytype:"tracks"}),GUI.plugin="Spotify";else if(e.hasClass("db-dirble")){c=GUI.currentpath+"/"+e.find("span").text();var f=e.hasClass("db-dirble-child")?"stations":"childs";getDB({path:c,plugin:"Dirble",querytype:f,args:e.data("path")}),GUI.plugin="Dirble"}else e.hasClass("db-jamendo")||(e.hasClass("db-podcast")?(c=GUI.currentpath+"/"+e.find("span").text(),getDB({path:c,browsemode:GUI.browsemode,plugin:"Podcast",querytype:"content",args:e.data("path")}),GUI.plugin="Podcast"):(d=e.data("browsemode"),getDB({path:c,uplevel:0,browsemode:d})));var g=e.attr("id");g=g.replace("db-",""),GUI.currentDBpos[GUI.currentDBpos[10]]=g,GUI.currentDBpath[GUI.currentDBpos[10]]=c,++GUI.currentDBpos[10]}else e.hasClass("db-webradio-add")?a("#modal-webradio-add").modal():e.hasClass("db-podcast-add")&&a("#modal-podcast-add").modal()}),f.on("dblclick","li",function(b){var c=a(this);if(!a(b.target).hasClass("db-action")){a("li.active","#database-entries").removeClass("active"),c.addClass("active");var d=c.data("path");c.hasClass("db-spotify")?(d=c.attr("data-plid")+"-"+c.attr("data-path"),getDB({cmd:"spaddplay",path:d,querytype:"spotify-track"})):(d=c.hasClass("db-dirble")?d.split(" | ")[1]:d,getDB({cmd:"addplay",path:d}))}}),a("#db-level-up").click(function(){--GUI.currentDBpos[10];var a=GUI.currentpath;if(0===GUI.currentDBpos[10])a="";else if("file"===GUI.browsemode){var b=a.lastIndexOf("/");a=-1!==b?a.slice(0,b):""}else"album"===GUI.browsemode?(a=GUI.currentDBpath[GUI.currentDBpos[10]-1],""===a?a="Albums":GUI.browsemode="artist"):"artist"===GUI.browsemode?(a=GUI.currentDBpath[GUI.currentDBpos[10]-1],""===a?a="Artists":GUI.browsemode="genre"):"genre"===GUI.browsemode?a="Genres":"albumfilter"===GUI.browsemode&&(GUI.browsemode="artist",a=GUI.currentDBpath[GUI.currentDBpos[10]-1]);getDB({browsemode:GUI.browsemode,path:a,plugin:GUI.plugin,uplevel:1}),GUI.plugin=""}),a("#db-search-results").click(function(){a(this).addClass("hide"),a("#db-level-up").removeClass("hide"),getDB({path:GUI.currentpath})}),a("a",".context-menu").click(function(){var b=a(this).data("cmd"),c=a(this).data("type"),d=GUI.DBentry[0];switch(GUI.DBentry[0]="",b){case"pl-add":sendCmd('load "'+d+'"');break;case"pl-replace":sendCmd("clear"),sendCmd('load "'+d+'"');break;case"pl-rename":a("#modal-pl-rename").modal(),a("#pl-rename-oldname").text(d);break;case"pl-rm":a.ajax({url:"/command/?cmd=rm%20%22"+d+"%22",success:function(a){getPlaylists(a)}});break;case"wradd":d=d.split(" | ")[1],getDB({cmd:"add",path:d});break;case"wraddplay":d=d.split(" | ")[1],getDB({cmd:"addplay",path:d});break;case"wraddreplaceplay":d=d.split(" | ")[1],getDB({cmd:"addreplaceplay",path:d});break;case"wredit":a("#modal-webradio-edit").modal(),a.post("/db/?cmd=readradio",{filename:d},function(b){var c=a("#webradio-edit-name");c.val(b.name),c.data("file-name",b.name),a("#webradio-edit-url").val(b.url)},"json");break;case"wrdelete":a("#modal-webradio-delete").modal(),a("#webradio-delete-name").text(d.replace("Webradio/",""));break;case"wrsave":var e=d.split(" | ");a.post("/db/?cmd=addradio",{"radio[label]":e[0],"radio[url]":e[1]});break;case"podedit":a("#modal-podcast-edit").modal(),a.post("/db/?cmd=readpodcast",{filename:d},function(b){var c=a("#podcast-edit-name");c.val(b.name),c.data("file-name",b.name),a("#podcast-edit-url").val(b.url)},"json");break;case"poddelete":a("#modal-podcast-delete").modal(),d=d.split(" | ")[0],a("#podcast-delete-name").text(d.replace("Podcast/",""));break;case"podsave":var e=d.split(" | ");a.post("/db/?cmd=addpodcast",{"podcast[label]":e[0],"podcast[url]":e[1]});break;default:getDB({cmd:b,path:d,browsemode:GUI.browsemode,querytype:c})}}),a("#webradio-add-button").click(function(){var b=a("#webradio-add-name").val(),c=a("#webradio-add-url").val();""===b||""===c?renderMSG([{title:"Missing fields",text:"Please fill both fields to continue",icon:"fa fa-warning"}]):(a.post("/db/?cmd=addradio",{"radio[label]":b,"radio[url]":c},function(){},"json"),a("#modal-webradio-add").modal("hide"),a("#webradio-add-name").val(""),a("#webradio-add-url").val(""))}),a("#webradio-edit-button").click(function(){var b=a("#webradio-edit-name");a.post("/db/?cmd=editradio",{"radio[newlabel]":b.val(),"radio[label]":b.data("file-name"),"radio[url]":a("#webradio-edit-url").val()},function(){},"json")}),a("#webradio-delete-button").click(function(){var b=a("#webradio-delete-name").text();a.post("/db/?cmd=deleteradio",{"radio[label]":b},function(){},"json")}),a("#podcast-add-button").click(function(){var b=a("#podcast-add-name").val(),c=a("#podcast-add-url").val();""===b||""===c?renderMSG([{title:"Missing fields",text:"Please fill both fields to continue",icon:"fa fa-warning"}]):(a.post("/db/?cmd=addpodcast",{"podcast[label]":b,"podcast[url]":c},function(){},"json"),a("#modal-podcast-add").modal("hide"),a("#podcast-add-name").val(""),a("#podcast-add-url").val(""))}),a("#podcast-edit-button").click(function(){var b=a("#podcast-edit-name");a.post("/db/?cmd=editpodcast",{"podcast[newlabel]":b.val(),"podcast[label]":b.data("file-name"),"podcast[url]":a("#podcast-edit-url").val()},function(){},"json")}),a("#podcast-delete-button").click(function(){var b=a("#podcast-delete-name").text();a.post("/db/?cmd=deletepodcast",{"podcast[label]":b},function(){},"json")}),a("#db-firstPage").click(function(){a.scrollTo(0,500)}),a("#db-prevPage").click(function(){var b="-="+a(window).height()+"px";a.scrollTo(b,500)}),a("#db-nextPage").click(function(){var b="+="+a(window).height()+"px";a.scrollTo(b,500)}),a("#db-lastPage").click(function(){a.scrollTo("100%",500)}),a("#pl-firstPage").click(function(){a.scrollTo(0,500)}),a("#pl-prevPage").click(function(){var b=a(window).scrollTop(),c=b-a(window).height();a.scrollTo(c,500)}),a("#pl-nextPage").click(function(){var b=a(window).scrollTop(),c=b+a(window).height();a.scrollTo(c,500)}),a("#pl-lastPage").click(function(){a.scrollTo("100%",500)});var g=document.location.toString();g.match("#")&&a('#menu-bottom a[href="/#'+g.split("#")[1]+'"]').tab("show"),a("#menu-bottom a").on("shown",function(a){history.pushState?history.pushState(null,null,a.target.hash):window.location.hash=a.target.hash}).on("click",function(){a("#overlay-social").hasClass("open")&&a(".overlay-close").trigger("click")}),a(".ttip").length&&a(".ttip").tooltip(),FastClick.attach(document.body),a("#syscmd-poweroff").click(function(){a.post("/settings/",{syscmd:"poweroff"}),toggleLoader()}),a("#syscmd-reboot").click(function(){a.post("/settings/",{syscmd:"reboot"}),toggleLoader()}),a("#overlay-sleep-open").click(function(){a("#modal-sleep-start").modal(),a(".touchspin").TouchSpin({min:1,max:60,boostat:5,maxboostedstep:5})}),overlayTrigger("#overlay-social"),overlayTrigger("#overlay-playsource"),a("#playsource-mpd").click(function(){a(this).hasClass("inactive")&&(a.ajax({url:"/command/?switchplayer=MPD"}),a("#overlay-playsource-close").trigger("click"))}),a("#playsource-spotify").click(function(){a(this).hasClass("inactive")&&("1"===GUI.libraryhome.Spotify?(a.ajax({url:"/command/?switchplayer=Spotify"}),a("#overlay-playsource-close").trigger("click")):new PNotify({title:"Spotify not enabled",text:"Enable and configure it under the Settings screen",icon:"fa fa-exclamation-circle"}))}),a("#sleep-start-button").click(function(){var b=a("#sleep-mode-time").val();a.ajax({url:"/command/?sleepmodestart="+b}),a("#modal-sleep-start").modal("hide")})}):(jQuery(document).ready(function(a){"use strict";if(GUI.mode=checkWebSocket(),playbackChannel(),PNotify.prototype.options.styling="fontawesome",PNotify.prototype.options.stack.dir1="up",PNotify.prototype.options.stack.dir2="left",PNotify.prototype.options.stack.firstpos1=90,PNotify.prototype.options.stack.firstpos2=50,PNotify.prototype.options.stack.spacing1=10,PNotify.prototype.options.stack.spacing2=10,notifyChannel(),a(".btn-cmd").click(function(){var b=a(this);commandButton(b)}),a("#syscmd-poweroff").click(function(){a.post("/settings/",{syscmd:"poweroff"}),toggleLoader()}),a("#syscmd-reboot").click(function(){a.post("/settings/",{syscmd:"reboot"}),toggleLoader()}),a(".selectpicker").selectpicker(),a(".clockpicker").clockpicker({autoclose:!0}),a(".touchspin").TouchSpin({min:0,max:999,boostat:10,maxboostedstep:10}),a("#section-sources").length&&("nfs"===a("#mount-type").val()&&a("#mount-cifs").addClass("disabled").children(".disabler").removeClass("hide"),a("#mount-type").change(function(){"cifs"===a(this).val()||"osx"===a(this).val()?a("#mount-cifs").removeClass("disabled").children(".disabler").addClass("hide"):a("#mount-cifs").addClass("disabled").children(".disabler").removeClass("hide")}),a("#nas-guest").change(function(){a(this).prop("checked")?a("#mount-auth").addClass("disabled").children(".disabler").removeClass("hide"):a("#mount-auth").removeClass("disabled").children(".disabler").addClass("hide")}),a("#nas-advanced").change(function(){a(this).prop("checked")?a("#mount-advanced-config").removeClass("hide"):a("#mount-advanced-config").addClass("hide")}),a("#show-mount-advanced-config").click(function(b){b.preventDefault(),a(this).hasClass("active")?(a("#mount-advanced-config").toggleClass("hide"),a(this).removeClass("active"),a(this).find("i").removeClass("fa fa-minus-circle").addClass("fa fa-plus-circle"),a(this).find("span").html("show advanced options")):(a("#mount-advanced-config").toggleClass("hide"),a(this).addClass("active"),a(this).find("i").removeClass("fa fa-plus-circle").addClass("fa fa-minus-circle"),a(this).find("span").html("hide advanced options"))}),a("#usb-mount-list a").click(function(){var b=a(this).data("mount");a("#usb-umount-name").html(b),a("#usb-umount").val(b)})),a("#section-settings").length&&(a("#airplay").change(function(){a(this).prop("checked")?(a("#airplayName").removeClass("hide"),a("#airplayBox").addClass("boxed-group")):(a("#airplayName").addClass("hide"),a("#airplayBox").removeClass("boxed-group"))}),a("#scrobbling-lastfm").change(function(){a(this).prop("checked")?(a("#lastfmAuth").removeClass("hide"),a("#lastfmBox").addClass("boxed-group")):(a("#lastfmAuth").addClass("hide"),a("#lastfmBox").removeClass("boxed-group"))}),a("#proxy").change(function(){a(this).prop("checked")?(a("#proxyAuth").removeClass("hide"),a("#proxyBox").addClass("boxed-group")):(a("#proxyAuth").addClass("hide"),a("#proxyBox").removeClass("boxed-group"))}),a("#dlna").change(function(){a(this).prop("checked")?(a("#dlnaName").removeClass("hide"),a("#dlnaBox").addClass("boxed-group")):(a("#dlnaName").addClass("hide"),a("#dlnaBox").removeClass("boxed-group"))}),a("#spotify").change(function(){a(this).prop("checked")?(a("#spotifyAuth").removeClass("hide"),a("#spotifyBox").addClass("boxed-group")):(a("#spotifyAuth").addClass("hide"),a("#spotifyBox").removeClass("boxed-group"))}),a(".btn-file :file").on("fileselect",function(b,c,d){var e=a(this).parents(".input-group").find(":text");e.length?e.val(d):d&&(console.log("Selected file: ",d),d.indexOf("backup_")>-1&&d.indexOf(".tar.gz")>-1?(a("#backup-file").html(' <i class="fa fa-check dx green"></i> '+d),a("#btn-backup-upload").prop("disabled",!1)):(a("#backup-file").html(' <i class="fa fa-times dx red"></i> not a valid backup file'),a("#btn-backup-upload").prop("disabled",!0)))})),a("#section-network").length){var b=a("#network-manual-config");"0"===a("#dhcp").val()&&b.removeClass("hide"),a("#dhcp").change(function(){"0"===a(this).val()?b.removeClass("hide"):b.addClass("hide")});var c=a("#wifi-security-key");"open"!==a("#wifi-security").val()&&c.removeClass("hide"),a("#wifi-security").change(function(){"open"!==a(this).val()?c.removeClass("hide"):c.addClass("hide")}),a("#wifiNetworks").length&&(wlansChannel(),nicsChannel()),a("#wifiProfiles").change(function(){a(this).prop("checked")?a("#wifiProfilesBox").addClass("hide"):a("#wifiProfilesBox").removeClass("hide")})}if(a("#section-mpd").length&&(a("#audio-output-interface").change(function(){renderMSG([{title:"Switching audio output",text:"Please wait for the config update...",icon:"fa fa-cog fa-spin",delay:5e3}]);var b=a(this).val();a.ajax({type:"POST",url:"/mpd/",data:{ao:b}})}),a(".manual-edit-confirm").find(".btn-primary").click(function(){a("#mpdconf_editor").removeClass("hide"),a("#manual-edit-warning").addClass("hide")})),a("#section-debug").length){ZeroClipboard.config({swfPath:"/assets/js/vendor/ZeroClipboard.swf"});var d=new ZeroClipboard(document.getElementById("copy-to-clipboard"));d.on("ready",function(){d.on("aftercopy",function(){new PNotify({title:"Copied to clipboard",text:"The debug output was copied successfully in your clipboard.",icon:"fa fa-check"})})})}}),$(document).on("change",".btn-file :file",function(){var a=$(this),b=a.get(0).files?a.get(0).files.length:1,c=a.val().replace(/\\/g,"/").replace(/.*\//,"");a.trigger("fileselect",[b,c])}));